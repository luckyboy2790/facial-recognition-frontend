import{j as e,X as j,p as b,V as A,a as D,R as L}from"./index-D0yRYkRK.js";import{A as v}from"./AdaptiveCard-C-V2GotN.js";import{B as u}from"./Button-BDkok-2I.js";import"./isNil-BZddQIJL.js";import"./context-CCEg-Yz5.js";import"./index-BAiP7mQm.js";import"./Dialog-B-jFmH1-.js";import"./index-B0EMbVo3.js";import{c as x}from"./cloneDeep-6-NADjKH.js";import"./index-2Mnet4ey.js";import"./debounce-D_S4yuNl.js";import"./index-92mjx-Fn.js";import"./index-DLKOtp8K.js";import"./Drawer-CnBtluTf.js";import{v as I,C as _,h as z,g as R}from"./index-BF8ULv3O.js";import{C as B}from"./index-DasjbrLe.js";import"./FileItem-BgKRNRi7.js";import"./FormContainer-CcnkfPvj.js";import{I as F}from"./Input-CGGIPAMy.js";import"./index-DUpuQ3pa.js";import"./index-4hbIhcSA.js";import{t as $,N as O}from"./toast-CHrgrvAn.js";import"./index-CI41wOCL.js";import{r as q}from"./index-CLuxvRnD.js";import{u as N}from"./index-x4T1Tg8z.js";import{D as E}from"./DataTable-H1C01gQK.js";import{S as P}from"./StickyFooter-CcqeJsEO.js";import{C as W}from"./ConfirmDialog-DLSh7DuB.js";import{D as V}from"./DebouceInput-BQU4gTK3.js";import"./Card-CWfRWYfe.js";import"./classNames-CVFWYafE.js";import"./index-Chjiymov.js";import"./useMergeRef-Ch7lRZ9Z.js";import"./floating-ui.dom-CV1Qg3mg.js";import"./index-BsIi-NiL.js";import"./proxy-CceN8Kfo.js";import"./index-C6AgsrmA.js";import"./CloseButton-V3ZvNBNU.js";import"./useControllableState-DfqdUqDh.js";import"./_getPrototype-CX1IXfHZ.js";import"./isSymbol-DKaeyIQo.js";import"./toString-Db7_635E.js";import"./index-BrAlWePZ.js";import"./DatePickerRange-DFku8Lpw.js";import"./StatusIcon-BDOIg_yW.js";import"./Select-B-WXjZfd.js";import"./extends-DynerIcZ.js";import"./index-BerKXuJv.js";import"./useDebounce-D4jIpCY2.js";const K=()=>{const t=[];return e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx(B,{className:"w-full",filename:"companyList.csv",data:t,children:e.jsx(u,{icon:e.jsx(I,{className:"text-xl"}),className:"w-full",children:"Download"})}),e.jsx(u,{variant:"solid",icon:e.jsx(_,{className:"text-xl"}),children:"Import"})]})},S="http://localhost:5000";async function M(t){const{token:a}=j();return b.fetchDataWithAxios({url:`${S}/api/company`,method:"get",params:t,headers:a?{Authorization:`Bearer ${a}`}:{}})}async function Q(t){const{token:a}=j();return b.fetchDataWithAxios({url:`${S}/api/company/create`,method:"post",data:t,headers:a?{Authorization:`Bearer ${a}`}:{}})}async function U(t){const{token:a}=j();return b.fetchDataWithAxios({url:`${S}/api/company/delete`,method:"post",data:t,headers:a?{Authorization:`Bearer ${a}`}:{}})}const X={pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Y={tableData:X,selectedCompany:[]},G=A(t=>({...Y,setTableData:a=>t(()=>({tableData:a})),setSelectedCompany:(a,o)=>t(s=>{const n=s.selectedCompany;return a?{selectedCompany:[...n,o]}:n.some(r=>o._id===r._id)?{selectedCompany:n.filter(r=>r._id!==o._id)}:{selectedCompany:n}}),setSelectAllCompany:a=>t(()=>({selectedCompany:a}))}));function y(){const{tableData:t,setTableData:a,selectedCompany:o,setSelectedCompany:s,setSelectAllCompany:n}=G(h=>h),{data:r,error:d,isLoading:m,mutate:l}=N(["/api/company",{...t}],([h,g])=>M(g),{revalidateOnFocus:!1}),p=async h=>{await U({companies:h}),l(),n([])},f=(r==null?void 0:r.list)||[],C=(r==null?void 0:r.total)||0;return{companyList:f,customerListTotal:C,error:d,isLoading:m,tableData:t,mutate:l,setTableData:a,selectedCompany:o,setSelectedCompany:s,setSelectAllCompany:n,deleteCompanies:p}}const H=()=>{const[t,a]=D.useState(""),{mutate:o}=y(),s=async()=>Q({companyName:t}),{data:n,isLoading:r}=N("/api/company/create",{revalidateOnFocus:!1}),d=async()=>{var m;try{if(t===""){$.push(e.jsx(O,{title:"error",type:"danger",children:"You have to fill company name."}));return}const l=await s();(m=l==null?void 0:l.company)!=null&&m._id&&(o(),a("")),console.log(l)}catch(l){console.error("Error creating company:",l)}};return e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsx(F,{placeholder:"Company name",required:!0,value:t,onChange:m=>a(m.target.value)}),e.jsx(u,{variant:"solid",icon:e.jsx(q,{}),onClick:d,disabled:r,children:"Create"})]})},J=()=>{const{companyList:t,customerListTotal:a,tableData:o,isLoading:s,setTableData:n,setSelectAllCompany:r,setSelectedCompany:d,selectedCompany:m}=y(),l=D.useMemo(()=>[{header:"Company Name",accessorKey:"company_name"}],[]),p=c=>{n(c),m.length>0&&r([])},f=c=>{const i=x(o);i.pageIndex=c,p(i)},C=c=>{const i=x(o);i.pageSize=Number(c),i.pageIndex=1,p(i)},h=c=>{const i=x(o);i.sort=c,p(i)},g=(c,i)=>{d(c,i)},T=(c,i)=>{if(c){const w=i.map(k=>k.original);r(w)}else r([])};return e.jsx(E,{selectable:!0,columns:l,data:t,noData:!s&&t.length===0,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:s,pagingData:{total:a,pageIndex:o.pageIndex,pageSize:o.pageSize},checkboxChecked:c=>m.some(i=>i._id===c._id),onPaginationChange:f,onSelectChange:C,onSort:h,onCheckBoxChange:g,onIndeterminateCheckBoxChange:T})},Z=()=>{const{selectedCompany:t,mutate:a,deleteCompanies:o}=y(),[s,n]=D.useState(!1),r=()=>{n(!0)},d=()=>{n(!1)},m=async()=>{const l=t.map(p=>p._id).filter(p=>p!==void 0);if(l.length===0){console.error("No valid company IDs to delete");return}try{await o(l),n(!1),a()}catch(p){console.error("Error deleting companies:",p)}};return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsx(P,{className:" flex items-center justify-between py-4 bg-white dark:bg-gray-800",stickyClass:"-mx-4 sm:-mx-8 border-t border-gray-200 dark:border-gray-700 px-8",defaultClass:"container mx-auto px-8 rounded-xl border border-gray-200 dark:border-gray-600 mt-4",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t.length>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg text-primary",children:e.jsx(z,{})}),e.jsxs("span",{className:"font-semibold flex items-center gap-1",children:[e.jsxs("span",{className:"heading-text",children:[t.length," ","Companies"]}),e.jsx("span",{children:"selected"})]})]})}),e.jsx("div",{className:"flex items-center",children:e.jsx(u,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error",onClick:r,children:"Delete"})})]})})}),e.jsx(W,{isOpen:s,type:"danger",title:"Remove companies",onClose:d,onRequestClose:d,onCancel:d,onConfirm:m,children:e.jsxs("p",{children:[" ","Are you sure you want to remove these companies? This action can't be undo."," "]})})]})},ee=t=>{const{onInputChange:a,ref:o}=t;return e.jsx(V,{ref:o,placeholder:"Quick search...",suffix:e.jsx(R,{className:"text-lg"}),onChange:s=>a(s.target.value)})},te=()=>{const{tableData:t,setTableData:a}=y(),o=s=>{const n=x(t);n.query=s,n.pageIndex=1,typeof s=="string"&&s.length>1&&a(n),typeof s=="string"&&s.length===0&&a(n)};return e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:e.jsx(ee,{onInputChange:o})})},He=()=>e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("h3",{children:"Add Company"}),e.jsx(K,{})]}),e.jsx(v,{children:e.jsx(H,{})}),e.jsxs(v,{children:[e.jsx(te,{}),e.jsx(J,{})]})]})}),e.jsx(Z,{})]});export{He as default};
