var z=Object.defineProperty;var B=(l,h,i)=>h in l?z(l,h,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[h]=i;var U=(l,h,i)=>B(l,typeof h!="symbol"?h+"":h,i);import{j as r,y as $,a as C,q as H,g as G,X as J,W as Z,R as Q}from"./index-D0yRYkRK.js";import{A as V}from"./AdaptiveCard-C-V2GotN.js";import{B as F}from"./Button-BDkok-2I.js";import"./isNil-BZddQIJL.js";import"./context-CCEg-Yz5.js";import"./index-BAiP7mQm.js";import{D as X}from"./Dialog-B-jFmH1-.js";import"./index-B0EMbVo3.js";import"./cloneDeep-6-NADjKH.js";import"./index-2Mnet4ey.js";import"./debounce-D_S4yuNl.js";import{g as K,h as Y}from"./index-CzqeFPSi.js";import"./index-92mjx-Fn.js";import"./index-DLKOtp8K.js";import"./Drawer-CnBtluTf.js";import{C as ee}from"./Card-CWfRWYfe.js";import{e as te,_ as re,a as ie,f as ne,l as oe,b as ae,c as se,n as ce,T as le,g as de,L as ue,F as pe}from"./FaceMatcher-CdmDyCLL.js";import{h as he}from"./employeeService-8m6wHAGi.js";import{d as fe}from"./AttendanceService-BTxDC8aW.js";import"./FileItem-BgKRNRi7.js";import"./FormContainer-CcnkfPvj.js";import"./index-DUpuQ3pa.js";import"./index-4hbIhcSA.js";import{t as k,N as T}from"./toast-CHrgrvAn.js";import"./index-CI41wOCL.js";import{s as P}from"./sleep-BvINh1mj.js";import{s as A}from"./index-CLuxvRnD.js";import"./classNames-CVFWYafE.js";import"./index-Chjiymov.js";import"./useMergeRef-Ch7lRZ9Z.js";import"./floating-ui.dom-CV1Qg3mg.js";import"./index-BsIi-NiL.js";import"./proxy-CceN8Kfo.js";import"./index-C6AgsrmA.js";import"./CloseButton-V3ZvNBNU.js";import"./useControllableState-DfqdUqDh.js";import"./_getPrototype-CX1IXfHZ.js";import"./isSymbol-DKaeyIQo.js";import"./toString-Db7_635E.js";import"./index-BF8ULv3O.js";import"./index-BrAlWePZ.js";import"./DatePickerRange-DFku8Lpw.js";import"./Input-CGGIPAMy.js";import"./StatusIcon-BDOIg_yW.js";function me(l){return new Promise(function(h,i){if(!(l instanceof Blob))return i("bufferToImage - expected buf to be of type: Blob");var a=new FileReader;a.onload=function(){if(typeof a.result!="string")return i("bufferToImage - expected reader.result to be a string, in onload");var s=te.getEnv().createImageElement();s.onload=function(){return h(s)},s.onerror=i,s.src=a.result},a.onerror=i,a.readAsDataURL(l)})}function ge(l){return re(this,void 0,void 0,function(){var h,i;return ie(this,function(a){switch(a.label){case 0:return[4,ne(l)];case 1:return h=a.sent(),[4,h.blob()];case 2:if(i=a.sent(),!i.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+i.type+", for url: "+h.url);return[2,me(i)]}})})}const _=({value:l,hidden:h=!1})=>r.jsxs("div",{className:"digital",children:[r.jsx("p",{children:l}),r.jsx("p",{className:$(h?"invisible":"visible"),children:l})]}),E=({value:l=0})=>{const h=String(l).padStart(2,"0");return r.jsxs("div",{className:"digital",children:[r.jsx("p",{children:"88"}),r.jsx("p",{children:h})]})},ve=["SUN","MON","TUE","WED","THU","FRI","SAT"],ye=({timezone:l})=>{const h=new Date(Date.now()).toLocaleTimeString("en-US",{timeZone:l}),[i,a]=C.useState(h),[s,u]=C.useState(0),[n,d]=C.useState(!1),[m,w]=C.useState(""),j=C.useRef(null),f=C.useRef(null);C.useEffect(()=>{const c=1e3-new Date(Date.now()).getMilliseconds();return j.current=setTimeout(()=>{f.current=setInterval(()=>{const o=new Date(Date.now());a(o.toLocaleTimeString("en-US",{timeZone:l}));const b=o.getTimezoneOffset()/60,y=b>0?`UTC-${b}`:`UTC+${-b}`;w(y);const v=o.getDay();u(v),d(o.getHours()>=12)})},c),()=>{j.current&&clearTimeout(j.current),f.current&&clearInterval(f.current)}},[l]);const[g]=i.split(" "),[p,e,t]=g.split(":");return r.jsxs("div",{className:"clock",children:[r.jsx("div",{className:"calendar",children:ve.map((c,o)=>r.jsx(_,{value:c,hidden:o!=s},c))}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"text-3xl pb-2 max-md:text-lg",children:r.jsx(_,{value:m,hidden:!1})}),r.jsxs("div",{className:"hour",children:[r.jsx(E,{value:parseInt(p,10)}),r.jsx(_,{value:":",hidden:!1}),r.jsx(E,{value:parseInt(e,10)}),r.jsx(_,{value:":",hidden:!1}),r.jsx(E,{value:parseInt(t,10)})]}),r.jsxs("div",{className:"ampm",children:[r.jsx(_,{value:"AM",hidden:n}),r.jsx(_,{value:"PM",hidden:!n})]})]})]})};var I={exports:{}},xe=I.exports,R;function be(){return R||(R=1,function(l,h){(function(a,s){l.exports=s(H())})(xe,function(i){return function(a){var s={};function u(n){if(s[n])return s[n].exports;var d=s[n]={i:n,l:!1,exports:{}};return a[n].call(d.exports,d,d.exports,u),d.l=!0,d.exports}return u.m=a,u.c=s,u.d=function(n,d,m){u.o(n,d)||Object.defineProperty(n,d,{enumerable:!0,get:m})},u.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},u.t=function(n,d){if(d&1&&(n=u(n)),d&8||d&4&&typeof n=="object"&&n&&n.__esModule)return n;var m=Object.create(null);if(u.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:n}),d&2&&typeof n!="string")for(var w in n)u.d(m,w,(function(j){return n[j]}).bind(null,w));return m},u.n=function(n){var d=n&&n.__esModule?function(){return n.default}:function(){return n};return u.d(d,"a",d),d},u.o=function(n,d){return Object.prototype.hasOwnProperty.call(n,d)},u.p="",u(u.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(a,s,u){u.r(s);var n=u("react"),d=function(){var g=function(p,e){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,c){t.__proto__=c}||function(t,c){for(var o in c)c.hasOwnProperty(o)&&(t[o]=c[o])},g(p,e)};return function(p,e){g(p,e);function t(){this.constructor=p}p.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),m=function(){return m=Object.assign||function(g){for(var p,e=1,t=arguments.length;e<t;e++){p=arguments[e];for(var c in p)Object.prototype.hasOwnProperty.call(p,c)&&(g[c]=p[c])}return g},m.apply(this,arguments)},w=function(g,p){var e={};for(var t in g)Object.prototype.hasOwnProperty.call(g,t)&&p.indexOf(t)<0&&(e[t]=g[t]);if(g!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,t=Object.getOwnPropertySymbols(g);c<t.length;c++)p.indexOf(t[c])<0&&Object.prototype.propertyIsEnumerable.call(g,t[c])&&(e[t[c]]=g[t[c]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(p){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,c){e.call(navigator,p,t,c)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function j(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var f=function(g){d(p,g);function p(e){var t=g.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return p.prototype.componentDidMount=function(){var e=this,t=e.state,c=e.props;if(this.unmounted=!1,!j()){c.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),c.children&&typeof c.children!="function"&&console.warn("children must be a function")},p.prototype.componentDidUpdate=function(e){var t=this.props;if(!j()){t.onUserMediaError("getUserMedia not supported");return}var c=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),o=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),b=e.minScreenshotWidth!==t.minScreenshotWidth,y=e.minScreenshotHeight!==t.minScreenshotHeight;(o||b||y)&&(this.canvas=null,this.ctx=null),(c||o)&&(this.stopAndCleanup(),this.requestUserMedia())},p.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},p.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},p.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(p.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},p.prototype.getScreenshot=function(e){var t=this,c=t.state,o=t.props;if(!c.hasUserMedia)return null;var b=this.getCanvas(e);return b&&b.toDataURL(o.screenshotFormat,o.screenshotQuality)},p.prototype.getCanvas=function(e){var t=this,c=t.state,o=t.props;if(!this.video||!c.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var b=this.video.videoWidth,y=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var v=b/y;b=o.minScreenshotWidth||this.video.clientWidth,y=b/v,o.minScreenshotHeight&&y<o.minScreenshotHeight&&(y=o.minScreenshotHeight,b=y*v)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||b,this.canvas.height=(e==null?void 0:e.height)||y,this.ctx=this.canvas.getContext("2d")}var M=this,S=M.ctx,x=M.canvas;return S&&x&&(x.width=(e==null?void 0:e.width)||x.width,x.height=(e==null?void 0:e.height)||x.height,o.mirrored&&(S.translate(x.width,0),S.scale(-1,1)),S.imageSmoothingEnabled=o.imageSmoothing,S.drawImage(this.video,0,0,(e==null?void 0:e.width)||x.width,(e==null?void 0:e.height)||x.height),o.mirrored&&(S.scale(-1,1),S.translate(-x.width,0))),x},p.prototype.requestUserMedia=function(){var e=this,t=this.props,c=function(y,v){var M={video:typeof v<"u"?v:!0};t.audio&&(M.audio=typeof y<"u"?y:!0),e.requestUserMediaId++;var S=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(M).then(function(x){e.unmounted||S!==e.requestUserMediaId?p.stopMediaStream(x):e.handleUserMedia(null,x)}).catch(function(x){e.handleUserMedia(x)})};if("mediaDevices"in navigator)c(t.audioConstraints,t.videoConstraints);else{var o=function(y){return{optional:[{sourceId:y}]}},b=function(y){var v=y.deviceId;return typeof v=="string"?v:Array.isArray(v)&&v.length>0?v[0]:typeof v=="object"&&v.ideal?v.ideal:null};MediaStreamTrack.getSources(function(y){var v=null,M=null;y.forEach(function(O){O.kind==="audio"?v=O.id:O.kind==="video"&&(M=O.id)});var S=b(t.audioConstraints);S&&(v=S);var x=b(t.videoConstraints);x&&(M=x),c(o(v),o(M))})}},p.prototype.handleUserMedia=function(e,t){var c=this.props;if(e||!t){this.setState({hasUserMedia:!1}),c.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}c.onUserMedia(t)},p.prototype.render=function(){var e=this,t=this,c=t.state,o=t.props,b=o.audio;o.forceScreenshotSourceSize;var y=o.disablePictureInPicture;o.onUserMedia,o.onUserMediaError,o.screenshotFormat,o.screenshotQuality,o.minScreenshotWidth,o.minScreenshotHeight,o.audioConstraints,o.videoConstraints,o.imageSmoothing;var v=o.mirrored,M=o.style,S=M===void 0?{}:M,x=o.children,O=w(o,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),W=v?m(m({},S),{transform:(S.transform||"")+" scaleX(-1)"}):S,q={getScreenshot:this.getScreenshot.bind(this)};return n.createElement(n.Fragment,null,n.createElement("video",m({autoPlay:!0,disablePictureInPicture:y,src:c.src,muted:!b,playsInline:!0,ref:function(L){e.video=L},style:W},O)),x&&x(q))},p.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},p}(n.Component);s.default=f},react:function(a,s){a.exports=i}}).default})}(I)),I.exports}var Se=be();const we=G(Se);async function je(){const l="/models";console.log(123456789),await oe(l),await ae(l),await se(l),console.log(console.log(ce))}async function Me(l,h=512){let i=.5;const a=new le({inputSize:h,scoreThreshold:i}),s=!0;let u=await ge(l);return await de(u,a).withFaceLandmarks(s).withFaceDescriptors()}const Ce=.5;async function Ue(l){let i=Object.keys(l).map(s=>new ue(l[s].name,l[s].descriptors.map(u=>new Float32Array(u))));return new pe(i,Ce)}const D=420,N=420,Oe=160;class _e extends C.Component{constructor(i){super(i);U(this,"webcam",C.createRef());U(this,"interval",null);U(this,"setInputDevice",()=>{var i;if(!((i=navigator.mediaDevices)!=null&&i.enumerateDevices)){console.error("navigator.mediaDevices is not available.");return}navigator.mediaDevices.enumerateDevices().then(a=>{const s=a.filter(u=>u.kind==="videoinput");this.setState({facingMode:s.length<2?"user":{exact:"environment"}},this.startCapture)})});U(this,"startCapture",()=>{this.interval=setInterval(this.capture,1500)});U(this,"capture",async()=>{if(this.webcam.current){const i=this.webcam.current.getScreenshot();if(i){const a=await Me(i,Oe);a&&this.setState({detections:a.map(s=>s.detection),descriptors:a.map(s=>s.descriptor)})}if(this.state.descriptors&&this.state.faceMatcher&&!this.state.requestSent){const a=this.state.descriptors.map(s=>this.state.faceMatcher.findBestMatch(s));this.setState({match:a},()=>this.handleMatch(a))}}});U(this,"handleMatch",async i=>{if(i.length>0&&i[0]._label!=="unknown"&&!this.state.requestSent){this.setState({requestSent:!0});const a=new Date,s=a.toISOString().split("T")[0],u=new Intl.DateTimeFormat("en-US",{timeZone:this.props.timezone,hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}).format(a)+"Z";let n="",d="";if(this.props.type==="time_out"){const f=await fe({id:i[0]._label});if(f&&f.time_in){const g=new Date(f.time_in);n=new Intl.DateTimeFormat("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}).format(g)+"Z",console.log(n),d=f._id}}let m={};this.props.type==="time_in"?m={employee:i[0]._label,date:s,time_in:u,time_out:""}:m={employee:i[0]._label,date:s,time_in:n,time_out:u};const w="http://localhost:5000",j=this.props.type==="time_in"?`${w}/api/attendance/create_attendance`:`${w}/api/attendance/update_attendance/${d}`;try{const f=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",...this.props.token?{Authorization:`Bearer ${this.props.token}`}:{}},body:JSON.stringify(m)}),g=await f.json();f.ok?(console.log("Successfully sent matched user data"),this.props.onCloseDialog(),k.push(r.jsx(T,{type:"success",children:"Face recognized!"}),{placement:"top-center"}),await P(1e3)):(this.props.onCloseDialog(),k.push(r.jsx(T,{type:"warning",children:g.message}),{placement:"top-center"}),await P(1e3),console.error("Failed to send user data"))}catch(f){console.error("Error sending request:",f)}}});this.state={fullDesc:null,detections:null,descriptors:null,faceMatcher:null,match:null,facingMode:null,requestSent:!1}}async componentDidMount(){const i=await he();if(console.log(i),Object.keys(i).length<=0){k.push(r.jsx(T,{type:"warning",children:"Employees are not exist!"}),{placement:"top-center"}),this.props.navigate("/employee");return}await je(),this.setState({faceMatcher:await Ue(i)}),this.setInputDevice()}componentWillUnmount(){this.interval&&clearInterval(this.interval)}render(){const{detections:i,match:a,facingMode:s}=this.state,u=s?{width:D,height:N,facingMode:s}:null,n=s==="user"?"Front":"Back";return r.jsxs("div",{className:"Camera",style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r.jsxs("p",{children:["Camera: ",n]}),r.jsx("div",{style:{width:D,height:N},children:r.jsxs("div",{style:{position:"relative",width:D},children:[u&&r.jsx("div",{style:{position:"absolute"},children:r.jsx(we,{audio:!1,width:D,height:N,ref:this.webcam,screenshotFormat:"image/jpeg",videoConstraints:u})}),i==null?void 0:i.map((d,m)=>r.jsx("div",{style:{position:"absolute",border:"solid",borderColor:"blue",height:d.box.height,width:d.box.width,transform:`translate(${d.box._x}px,${d.box._y}px)`},children:(a==null?void 0:a[m])&&r.jsx("p",{style:{backgroundColor:"blue",border:"solid",borderColor:"blue",width:d.box.width,marginTop:0,color:"#fff",transform:`translate(-3px,${d.box.height}px)`},children:a[m]._label})},m))]})})]})}}function De({onCloseDialog:l,type:h,timezone:i,navigate:a}){const{token:s}=J();return r.jsx(_e,{onCloseDialog:l,type:h,timezone:i,navigate:a,token:typeof s=="string"?s:null})}const Ie=l=>{const{title:h,description:i,icon:a,timezone:s}=l,u=Z(),[n,d]=C.useState(!1),m=()=>{d(!0)},w=f=>{console.log("onDialogClose",f),d(!1)},j=f=>{console.log("onDialogOk",f),d(!1)};return r.jsxs(r.Fragment,{children:[r.jsxs(ee,{clickable:!0,className:"w-full flex gap-4 justify-between rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 p-5 min-h-20 2xl:min-h-20 cursor-pointer",bodyClass:"p-4 w-full flex gap-8 justify-between",onClick:()=>m(),children:[r.jsx("div",{className:"text-6xl",children:a}),r.jsxs("div",{className:"grow flex flex-col justify-evenly",children:[r.jsx("h3",{children:h}),r.jsx("p",{className:"text-md",children:i})]})]}),r.jsxs(X,{isOpen:n,onClose:f=>w(f),onRequestClose:f=>w(f),children:[r.jsx("h5",{className:"mb-4",children:h}),r.jsx(De,{onCloseDialog:()=>d(!1),type:`${h==="Check In"?"time_in":"time_out"}`,timezone:s,navigate:u}),r.jsxs("div",{className:"text-right mt-6",children:[r.jsx(F,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:f=>w(f),children:"Cancel"}),r.jsx(F,{variant:"solid",onClick:f=>j(f),children:"Okay"})]})]})]})},ke=[{title:"Check In",description:"Check-in for your attendance",icon:r.jsx(A,{})},{title:"Check Out",description:"Check out for your attendance",icon:r.jsx(A,{})},{title:"Break In",description:"Break-in for your attendance",icon:r.jsx(K,{})},{title:"Break Out",description:"Break-out for your attendance",icon:r.jsx(Y,{})}],jt=()=>r.jsx(r.Fragment,{children:r.jsx(Q,{children:r.jsxs("div",{className:"flex flex-col gap-6",children:[r.jsx(V,{children:r.jsx(ye,{timezone:"America/Iqaluit"})}),r.jsx("div",{className:"grid grid-cols-2 max-md:grid-cols-1 gap-6",children:ke.map((l,h)=>r.jsx(Ie,{title:l.title,description:l.description,icon:l.icon,timezone:"America/Iqaluit"},h))})]})})});export{jt as default};
