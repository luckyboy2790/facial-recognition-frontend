import{V as _,W as O,a as C,j as e,X as F,e as A,R as M}from"./index-D0yRYkRK.js";import{A as G}from"./AdaptiveCard-C-V2GotN.js";import{T as q}from"./Tag-BiKNl5cb.js";import{T as K}from"./index-BAiP7mQm.js";import{D as V}from"./DataTable-H1C01gQK.js";import{u as $}from"./index-x4T1Tg8z.js";import{a as H,b as J,c as W}from"./UserService-BhDRbW5g.js";import{c as T}from"./cloneDeep-6-NADjKH.js";import{d as Y,b as Q,v as X,f as Z,g as ee,h as te,B as se}from"./index-BF8ULv3O.js";import{B as D}from"./Button-BDkok-2I.js";import{C as ae}from"./index-DasjbrLe.js";import{S as L}from"./index-DUpuQ3pa.js";import{D as le}from"./Dialog-B-jFmH1-.js";import{I as re}from"./Input-CGGIPAMy.js";import{S as oe}from"./ScrollBar-CQJRPbw6.js";import"./FormContainer-CcnkfPvj.js";import{F as P}from"./FormItem-BzCUTsvV.js";import"./index-2Mnet4ey.js";import"./FileItem-BgKRNRi7.js";import"./Drawer-CnBtluTf.js";import"./index-92mjx-Fn.js";import"./index-4hbIhcSA.js";import{t as ne,N as ie}from"./toast-CHrgrvAn.js";import{S as ce}from"./Select-B-WXjZfd.js";import"./index-B0EMbVo3.js";import"./index-CI41wOCL.js";import{D as de}from"./DebouceInput-BQU4gTK3.js";import{S as me}from"./StickyFooter-CcqeJsEO.js";import{C as z}from"./ConfirmDialog-DLSh7DuB.js";import{b as pe}from"./index-Car4HhLt.js";import"./isNil-BZddQIJL.js";import"./context-CCEg-Yz5.js";import"./debounce-D_S4yuNl.js";import"./index-DLKOtp8K.js";import"./Card-CWfRWYfe.js";import"./classNames-CVFWYafE.js";import"./useMergeRef-Ch7lRZ9Z.js";import"./floating-ui.dom-CV1Qg3mg.js";import"./index-BsIi-NiL.js";import"./proxy-CceN8Kfo.js";import"./index-BerKXuJv.js";import"./useControllableState-DfqdUqDh.js";import"./_getPrototype-CX1IXfHZ.js";import"./index-Chjiymov.js";import"./index-C6AgsrmA.js";import"./CloseButton-V3ZvNBNU.js";import"./isSymbol-DKaeyIQo.js";import"./toString-Db7_635E.js";import"./DatePickerRange-DFku8Lpw.js";import"./index-BrAlWePZ.js";import"./StatusIcon-BDOIg_yW.js";import"./extends-DynerIcZ.js";import"./index-CLuxvRnD.js";import"./useDebounce-D4jIpCY2.js";const ue={pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},he={tableData:ue,selectedUser:[]},xe=_(t=>({...he,setTableData:s=>t(()=>({tableData:s})),setSelectedUser:(s,o)=>t(l=>{const r=l.selectedUser;return s?{selectedUser:[...r,o]}:r.some(n=>o._id===n._id)?{selectedUser:r.filter(n=>n._id!==o._id)}:{selectedUser:r}}),setSelectAllUser:s=>t(()=>({selectedUser:s}))}));function U(){const{tableData:t,setTableData:s,selectedUser:o,setSelectedUser:l,setSelectAllUser:r}=xe(b=>b),{data:n,error:u,isLoading:f,mutate:h}=$(["/api/users",{...t}],([b,i])=>H(i),{revalidateOnFocus:!1}),x=async b=>{await J({userIds:b}),h(),r([])},y=(n==null?void 0:n.list)||[],g=(n==null?void 0:n.total)||0;return{userList:y,userListTotal:g,error:u,isLoading:f,tableData:t,mutate:h,deleteUsers:x,setTableData:s,selectedUser:o,setSelectedUser:l,setSelectAllUser:r}}const ge={Enabled:"bg-emerald-200 dark:bg-emerald-200 text-gray-900 dark:text-gray-900",Disabled:"bg-red-200 dark:bg-red-200 text-gray-900 dark:text-gray-900"},fe=({onEdit:t})=>e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(K,{title:"Edit",children:e.jsx("div",{className:"text-xl cursor-pointer select-none font-semibold",role:"button",onClick:t,children:e.jsx(Y,{})})})}),be=()=>{const t=O(),{userList:s,userListTotal:o,tableData:l,isLoading:r,setTableData:n,setSelectAllUser:u,setSelectedUser:f,selectedUser:h}=U(),x=c=>{t(`/users-edit/${c._id}`)},y=C.useMemo(()=>[{header:"Name",accessorKey:"employeeData.full_name"},{header:"Email",accessorKey:"email"},{header:"Role",accessorKey:"roleData.name"},{header:"Type",accessorKey:"account_type"},{header:"Status",accessorKey:"status",cell:c=>{const d=c.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx(q,{className:ge[d.status],children:e.jsx("span",{className:"capitalize",children:d.status})})})}},{header:"",id:"action",cell:c=>e.jsx(fe,{onEdit:()=>x(c.row.original)})}],[]),g=c=>{n(c),h.length>0&&u([])},b=c=>{const d=T(l);d.pageIndex=c,g(d)},i=c=>{const d=T(l);d.pageSize=Number(c),d.pageIndex=1,g(d)},k=c=>{const d=T(l);d.sort=c,g(d)},j=(c,d)=>{f(c,d)},w=(c,d)=>{if(c){const a=d.map(p=>p.original);u(a)}else u([])};return e.jsx(V,{selectable:!0,columns:y,data:s,noData:!r&&s.length===0,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:r,pagingData:{total:o,pageIndex:l.pageIndex,pageSize:l.pageSize},checkboxChecked:c=>h.some(d=>d._id===c._id),onPaginationChange:b,onSelectChange:i,onSort:k,onCheckBoxChange:j,onIndeterminateCheckBoxChange:w})},ve={pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},je={status:"",role:""},Ce={tableData:ve,filterData:je,selectedUser:[],selectedRole:"",roleDialog:{type:"",open:!1}},E=_(t=>({...Ce,setTableData:s=>t(()=>({tableData:s})),setFilterData:s=>t(()=>({filterData:s})),setSelectedUser:(s,o)=>t(l=>{const r=l.selectedUser;return s?{selectedUser:[...r,o]}:r.some(n=>o.id===n.id)?{selectedUser:r.filter(n=>n.id!==o.id)}:{selectedUser:r}}),setSelectAllUser:s=>t(()=>({selectedUser:s})),setSelectedRole:s=>t(()=>({selectedRole:s})),setRoleDialog:s=>t(()=>({roleDialog:s}))})),ye=()=>{const{setRoleDialog:t}=E();return e.jsx("div",{children:e.jsx(D,{variant:"solid",onClick:()=>t({type:"new",open:!0}),children:"Create role"})})},R=[{id:"dahsboard",name:"DASHBOARD",accessor:[{label:"Read",value:"read"}]},{id:"employee",name:"EMPLOYEES",accessor:[{label:"Create",value:"create"},{label:"Read",value:"read"},{label:"Update",value:"update"},{label:"Delete",value:"delete"},{label:"Archive",value:"archive"}]},{id:"attendance",name:"ATTENDANCES",accessor:[{label:"Update",value:"update"},{label:"Delete",value:"delete"}]},{id:"schedule",name:"SCHEDULES",accessor:[{label:"Create",value:"create"},{label:"Read",value:"read"},{label:"Update",value:"update"},{label:"Delete",value:"delete"}]},{id:"leave",name:"LEAVE",accessor:[{label:"Update",value:"update"},{label:"Delete",value:"delete"}]},{id:"setting",name:"SETTINGS",accessor:[{label:"Update",value:"update"}]},{id:"report",name:"REPORTS",accessor:[{label:"Read",value:"read"}]},{id:"user",name:"USERS",accessor:[{label:"Create",value:"create"},{label:"Update",value:"update"},{label:"Delete",value:"delete"}]},{id:"role",name:"USER ROLES",accessor:[{label:"Create",value:"create"},{label:"Update",value:"update"},{label:"setPermission",value:"Set Permission"},{label:"Delete",value:"delete"}]},{id:"company",name:"COMPANIES",accessor:[{label:"Create",value:"create"},{label:"Delete",value:"delete"}]},{id:"department",name:"DEPARTMENTS",accessor:[{label:"Create",value:"create"},{label:"Delete",value:"delete"}]},{id:"jobTitles",name:"JOB TITLES",accessor:[{label:"Create",value:"create"},{label:"Delete",value:"delete"}]},{id:"leaveType",name:"LEAVE TYPES",accessor:[{label:"Create",value:"create"},{label:"Delete",value:"delete"}]},{id:"leaveGroup",name:"LEAVE GROUPS",accessor:[{label:"Create",value:"create"},{label:"Update",value:"update"},{label:"Delete",value:"delete"}]}];function De(t,s){return t.length===s+1}const Se="http://localhost:5000",I=[{value:"Active",label:"Active"},{value:"Disable",label:"Disable"}],Ne=({roleList:t,mutate:s})=>{const{selectedRole:o,setSelectedRole:l,setRoleDialog:r,roleDialog:n}=E(),[u,f]=C.useState({}),[h,x]=C.useState(null),{token:y}=F(),[g,b]=C.useState(""),i=()=>{b(""),x("Active"),f({}),l(""),r({type:"",open:!1})},k=async()=>{if(g===""||!h){ne.push(e.jsx(ie,{type:"warning",children:"Fill All Fields"}),{placement:"top-center"});return}const a={name:g||"Untitled Role",status:h||"",accessRight:u};try{const p=await fetch(`${Se}/api/user/${n.type==="new"?"create_role":`update_role/${o}`}`,{method:"POST",headers:{"Content-Type":"application/json",...y?{Authorization:`Bearer ${y}`}:{}},body:JSON.stringify(a)});if(!p.ok)throw new Error(`Failed to create role: ${p.statusText}`);s(),i()}catch(p){console.error("Error creating role:",p),alert("Failed to create role. Please try again.")}},j=C.useMemo(()=>t.find(a=>a._id===o),[o,t]),w=(a,p)=>{var S;const m=((S=R.find(v=>v.id===a))==null?void 0:S.accessor.map(v=>v.value))||[];f(v=>{const N={...v};return N[a]=p?m:[],{...N}})},c=(a,p)=>{f(m=>({...m,[p]:a}))},d=a=>{const p=R.find(v=>v.id===a),m=u[a]||[],S=(p==null?void 0:p.accessor.map(v=>v.value))||[];return m.length===0?!1:m.length===S.length?!0:"indeterminate"};return C.useEffect(()=>{j&&(b(j.name||""),x(j.status||null),f(j.accessRight||{}))},[j]),e.jsxs(le,{isOpen:n.open,width:900,onClose:i,onRequestClose:i,children:[e.jsx("h4",{children:n.type==="new"?"Create role":j==null?void 0:j.name}),e.jsx(oe,{className:"mt-6 max-h-[600px] overflow-y-auto",children:e.jsxs("div",{className:"px-4",children:[e.jsx(P,{label:"Role name",children:e.jsx(re,{value:g,onChange:a=>b(a.target.value)})}),e.jsx(P,{label:"Status",children:e.jsx(ce,{className:"mb-4",placeholder:"Select status",options:I,value:I.find(a=>a.value===h),onChange:a=>x((a==null?void 0:a.value)||null)})}),e.jsx("span",{className:"font-semibold mb-2",children:"Roles"}),R.map((a,p)=>e.jsxs("div",{className:A("flex flex-col md:flex-row md:items-center justify-between gap-4 py-6 border-gray-200 dark:border-gray-600",!De(R,p)&&"border-b"),children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d(a.id)===!0,ref:m=>{m&&(m.indeterminate=d(a.id)==="indeterminate")},onChange:m=>w(a.id,m.target.checked),className:"cursor-pointer"}),e.jsx("h6",{className:"font-bold text-sm",children:a.name})]})}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(L,{className:"bg-transparent dark:bg-transparent",selectionType:"multiple",value:u[a.id]||[],onChange:m=>c(m,a.id),children:a.accessor.map(m=>e.jsx(L.Item,{value:m.value,children:({active:S,onSegmentItemClick:v})=>e.jsx(D,{variant:"default",icon:S?e.jsx(Q,{className:"text-primary text-xl"}):e.jsx(e.Fragment,{}),active:S,type:"button",className:"md:min-w-[100px]",size:"sm",customColorClass:({active:N})=>A(N&&"bg-transparent dark:bg-transparent text-primary border-primary ring-1 ring-primary"),onClick:v,children:m.label})},a.id+m.value))})})]},a.id)),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx(D,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:i,children:"Cancel"}),e.jsx(D,{variant:"solid",onClick:k,children:n.type==="edit"?"Update":"Create"})]})]})})]})};function B(){const{data:t,isLoading:s,error:o,mutate:l}=$(["/api/rbac/roles"],()=>W(),{revalidateOnFocus:!1,revalidateIfStale:!1,revalidateOnReconnect:!1});return{roleList:(t==null?void 0:t.roleList)||[],error:o,isLoading:s,mutate:l}}const Re=()=>{const t=O(),{userList:s}=U(),{roleList:o,mutate:l}=B();return e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx(ae,{className:"w-full",filename:"userList.csv",data:s,children:e.jsx(D,{icon:e.jsx(X,{className:"text-xl"}),className:"w-full",children:"Download"})}),e.jsx(ye,{}),e.jsx(D,{variant:"solid",icon:e.jsx(Z,{className:"text-xl"}),onClick:()=>t("/users-create"),children:"Add new"}),e.jsx(Ne,{roleList:o,mutate:l})]})},Te=t=>{const{onInputChange:s,ref:o}=t;return e.jsx(de,{ref:o,placeholder:"Quick search...",suffix:e.jsx(ee,{className:"text-lg"}),onChange:l=>s(l.target.value)})},Ue=()=>{const{tableData:t,setTableData:s}=U(),o=l=>{const r=T(t);r.query=l,r.pageIndex=1,typeof l=="string"&&l.length>1&&s(r),typeof l=="string"&&l.length===0&&s(r)};return e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:e.jsx(Te,{onInputChange:o})})},ke=()=>{const{selectedUser:t,mutate:s,deleteUsers:o}=U(),[l,r]=C.useState(!1),n=()=>{r(!0)},u=()=>{r(!1)},f=async()=>{const h=t.map(x=>x._id).filter(x=>x!==void 0);if(h.length===0){console.error("No valid employee IDs to delete");return}try{await o(h),r(!1),s()}catch(x){console.error("Error deleting companies:",x)}};return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsx(me,{className:" flex items-center justify-between py-4 bg-white dark:bg-gray-800",stickyClass:"-mx-4 sm:-mx-8 border-t border-gray-200 dark:border-gray-700 px-8",defaultClass:"container mx-auto px-8 rounded-xl border border-gray-200 dark:border-gray-600 mt-4",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t.length>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg text-primary",children:e.jsx(te,{})}),e.jsxs("span",{className:"font-semibold flex items-center gap-1",children:[e.jsxs("span",{className:"heading-text",children:[t.length," Users"]}),e.jsx("span",{children:"selected"})]})]})}),e.jsx("div",{className:"flex items-center",children:e.jsx(D,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error",onClick:n,children:"Delete"})})]})})}),e.jsx(z,{isOpen:l,type:"danger",title:"Remove users",onClose:u,onRequestClose:u,onCancel:u,onConfirm:f,children:e.jsxs("p",{children:[" ","Are you sure you want to remove these users? This action can't be undo."," "]})})]})},we="http://localhost:5000",Ee=({roleList:t,mutate:s})=>{const{setSelectedRole:o,setRoleDialog:l}=E(),[r,n]=C.useState(!1),[u,f]=C.useState(""),{token:h}=F(),x=i=>{n(!0),f(i)},y=i=>{o(i),l({type:"edit",open:!0})},g=()=>{n(!1)},b=async()=>{try{const i=await fetch(`${we}/api/user/delete_role/${u}`,{method:"POST",headers:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{}}});if(!i.ok)throw new Error(`Failed to create role: ${i.statusText}`);s(),n(!1)}catch{}};return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:[t.map(i=>e.jsxs("div",{className:"flex flex-col justify-between rounded-2xl p-5 bg-gray-100 dark:bg-gray-700 min-h-[140px]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h6",{className:"font-bold",children:i.name}),e.jsx(pe,{className:"font-bold cursor-pointer",onClick:()=>{x(i._id)}})]}),e.jsx("div",{className:"flex items-center justify-between mt-4",children:e.jsx(D,{variant:"plain",size:"sm",className:"py-0 h-auto",icon:e.jsx(se,{}),iconAlignment:"end",onClick:()=>y(i._id),children:"Edit role"})})]},i._id)),e.jsx(z,{isOpen:r,type:"danger",title:"Remove Role",onClose:g,onRequestClose:g,onCancel:g,onConfirm:b,children:e.jsxs("p",{children:[" ","Are you sure you want to remove these role? This action can't be undo."," "]})})]})},At=()=>{const{roleList:t,mutate:s}=B();return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsx(G,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("h3",{children:"Users"}),e.jsx(Re,{})]}),e.jsx("div",{className:"mb-10",children:e.jsx(Ee,{roleList:t,mutate:s})}),e.jsx(Ue,{}),e.jsx(be,{})]})})}),e.jsx(ke,{})]})};export{At as default};
