import{Y as R,W as E,a as f,j as r,R as k,X as B}from"./index-D0yRYkRK.js";import{B as p}from"./Button-BDkok-2I.js";import{t as g,N as b}from"./toast-CHrgrvAn.js";import{C as O}from"./ConfirmDialog-DLSh7DuB.js";import{e as A}from"./employeeService-8m6wHAGi.js";import{C as z}from"./CustomerForm-CgNHCEPs.js";import{N as $}from"./NoUserFound-CrXboe5I.js";import{j as G,i as I}from"./index-BF8ULv3O.js";import{u as P}from"./index-x4T1Tg8z.js";import"./classNames-CVFWYafE.js";import"./StatusIcon-BDOIg_yW.js";import"./CloseButton-V3ZvNBNU.js";import"./proxy-CceN8Kfo.js";import"./index-BAiP7mQm.js";import"./useMergeRef-Ch7lRZ9Z.js";import"./floating-ui.dom-CV1Qg3mg.js";import"./index-BsIi-NiL.js";import"./Dialog-B-jFmH1-.js";import"./index-C6AgsrmA.js";import"./index-Chjiymov.js";import"./index.esm-0Wd5ZTaL.js";import"./FormContainer-CcnkfPvj.js";import"./BottomStickyBar-B9Gkuokk.js";import"./Card-CWfRWYfe.js";import"./Input-CGGIPAMy.js";import"./isNil-BZddQIJL.js";import"./Select-B-WXjZfd.js";import"./extends-DynerIcZ.js";import"./FormItem-BzCUTsvV.js";import"./NumericInput-Buu8NxfF.js";import"./countries.constant-D1gzs3ev.js";import"./FileItem-BgKRNRi7.js";import"./useControllableState-DfqdUqDh.js";import"./DatePickerRange-DFku8Lpw.js";import"./index-92mjx-Fn.js";import"./toString-Db7_635E.js";import"./isSymbol-DKaeyIQo.js";import"./index-BrAlWePZ.js";import"./index-2Mnet4ey.js";import"./cloneDeep-6-NADjKH.js";import"./_getPrototype-CX1IXfHZ.js";import"./Drawer-CnBtluTf.js";import"./index-DUpuQ3pa.js";import"./index-4hbIhcSA.js";import"./index-B0EMbVo3.js";import"./index-CLuxvRnD.js";import"./index-CI41wOCL.js";import"./context-CCEg-Yz5.js";import"./debounce-D_S4yuNl.js";import"./index-DLKOtp8K.js";import"./FaceMatcher-CdmDyCLL.js";import"./index-DMQ2Y9Ia.js";const j="http://localhost:5000",Ut=()=>{const{id:a}=R(),x=E(),{data:i,isLoading:l}=P([`/api/customers/${a}`,{id:a}],([t,e])=>A(e)),[C,s]=f.useState(!1),[_,n]=f.useState(!1),w=async t=>{console.log("Submitted values",t),n(!0);const{token:e}=B();try{let o=t.img;if(t.img&&t.img.startsWith("blob:")){const h=new FormData,F=await(await fetch(t.img)).blob();h.append("image",F,"profile.jpg");const c=await(await fetch(`${j}/api/upload-image`,{method:"POST",body:h,headers:{...e?{Authorization:`Bearer ${e}`}:{}}})).json();if(!c.success){console.error("❌ Failed to upload image:",c.message),n(!1);return}o=c.imageUrl}const d={...t,img:o,faceDescriptor:t.faceDescriptor,_id:a};console.log(d);const u=await fetch(`${j}/api/employee/update_employee`,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify(d)}),T=await u.json();if(!u.ok)throw new Error(T.message||"Failed to create employee");g.push(r.jsx(b,{type:"success",children:"Employee created successfully!"}),{placement:"top-center"}),window.location.href="/employees"}catch(o){console.error("❌ Error submitting form:",o)}n(!1)},N=()=>{s(!0),g.push(r.jsx(b,{type:"success",children:"Customer deleted!"}),{placement:"top-center"}),x("/concepts/customers/customer-list")},S=()=>{s(!0)},m=()=>{s(!1)},y=()=>{history.back()},v=t=>{var e,o;return{firstName:t.first_name,lastName:t.last_name,email:t.email,dialCode:t.dial_code,phoneNumber:t.phone_number,address:t.address,gender:t.gender,civilStatus:t.civil_status,height:t.height,weight:t.weight,age:t.age,birthday:t.birthday,nationalId:t.national_id,placeOfBirth:t.place_of_birth,img:t.img,company:t.company_id,department:t.department_id,jobTitle:String(t.job_title_id),pin:t.pin,companyEmail:t.company_email,leaveGroup:t.leave_group_id,employmentType:t.employee_type,employmentStatus:t.employee_status,officialStartDate:t.official_start_date,dateRegularized:t.date_regularized,faceDescriptor:Array.isArray((e=t.face_info)==null?void 0:e.descriptors[0])?(o=t.face_info)==null?void 0:o.descriptors[0].map(String):[]}},D=i&&i.data?v(i.data):{firstName:"",lastName:"",email:"",gender:"",img:"",phoneNumber:"",dialCode:"",address:"",civilStatus:"",height:"",weight:"",age:"",birthday:"",nationalId:"",placeOfBirth:"",company:"",department:"",jobTitle:"",pin:"",companyEmail:"",leaveGroup:"",employmentType:"",employmentStatus:"",officialStartDate:"",dateRegularized:"",faceDescriptor:[]};return r.jsxs(r.Fragment,{children:[!l&&!i&&r.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[r.jsx($,{height:280,width:280}),r.jsx("h3",{className:"mt-8",children:"No user found!"})]}),!l&&i&&r.jsxs(r.Fragment,{children:[r.jsx(z,{defaultValues:D,newCustomer:!1,onFormSubmit:w,children:r.jsx(k,{children:r.jsxs("div",{className:"flex items-center justify-between px-8",children:[r.jsx(p,{className:"ltr:mr-3 rtl:ml-3",type:"button",variant:"plain",icon:r.jsx(G,{}),onClick:y,children:"Back"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(p,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:r.jsx(I,{}),onClick:S,children:"Delete"}),r.jsx(p,{variant:"solid",type:"submit",loading:_,children:"Save"})]})]})})}),r.jsx(O,{isOpen:C,type:"danger",title:"Remove customers",onClose:m,onRequestClose:m,onCancel:m,onConfirm:N,children:r.jsxs("p",{children:["Are you sure you want to remove this customer? This action can't be undo."," "]})})]})]})};export{Ut as default};
